# Plan 04-01: NPC AI Behavior Implementation

**Status:** âœ… Complete
**Started:** 2026-01-30

## Objective

Implement NPC AI that automatically counterattacks, selects defense modes, and attempts to flee when health is low.

## Tasks

- [x] **Task 1**: Create INpcAiService interface and implementation
- [x] **Task 2**: Implement flee decision logic (AI-03, AI-04)
- [x] **Task 3**: Implement defense mode selection (AI-02)
- [x] **Task 4**: Implement counterattack logic (AI-01)
- [x] **Task 5**: Integrate with HealthTickBackgroundService (TICK-05)
- [x] **Task 6**: Add integration tests (6 tests passing)

## Files to Create/Modify

- `Mordecai.Game/Services/INpcAiService.cs` - New interface
- `Mordecai.Web/Services/NpcAiService.cs` - New implementation
- `Mordecai.Web/Services/HealthTickBackgroundService.cs` - Add AI tick call
- `Mordecai.Web/Program.cs` - Register NpcAiService
- `Mordecai.Web.Tests/NpcAiTests.cs` - Integration tests

## Success Criteria

1. NPCs automatically counterattack when attacked
2. NPCs attempt flee at low VIT
3. NPCs switch to parry mode when FAT is low
4. All existing tests still pass
5. New tests cover AI behaviors
